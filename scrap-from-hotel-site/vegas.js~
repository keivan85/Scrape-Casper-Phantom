/****************************************
*Grab the hotel name and price
*Print name and price in console
*wait fro selector load
****************************************/


var casper = require('casper').create({
	verbose: true,
    logLevel: 'debug',
    pageSettings: {
        loadImages:  false,        // The WebPage instance used by Casper will
        loadPlugins: false,         // use these settings
        userAgent: 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36 Edge/12.0'
    },
    clientScripts:["vendor/jquery.min.js", "vendor/lodash.js"]
});

var url= 'https://www.agoda.com/en-gb/pages/agoda/default/DestinationSearchResult.aspx?asq=u2qcKLxwzRU5NDuxJ0kOF9qc6iYHx6nN7nnGV8SeY3o1vfv%2ffnGBWznj2In3R6GWoHxCNHZ7i%2bMFciATRgDLpfbeA9Tomk2aP%2fn8JcGFj3VeRYF2XNO9qpj%2fUACRn3SINXKZ9vPhCvIbUQ9OqSmCh05%2bY6QLDKe6dc0i02gALtOUiiTrRdNJyjwb1ILzTs24wirZWtm%2bK14XplpASpjtrKhK962Ek%2bKkmsPoxQ5%2bHZhCXLL4BiFbcVzii4CZQvlQikrSP3cx4715NAYXt0MMqV0kDZ2XPu1NlU1LEY4%2fLMg%3d&city=17072&tick=636115316396&pagetypeid=1&origin=FI&cid=-1&htmlLanguage=en-gb&checkIn=2016-10-17&checkOut=2016-10-18&los=1&rooms=1&adults=2&children=0&isFromSearchBox=true&ckuid=e8910244-18cf-49b2-b927-757c63ff35ee'

var names=[];
var prices=[];




function getNames() {
	var names = $('[data-selenium=hotel-name]');
	return _.map(names, function(e) {
		return e.innerHTML;
	});
};

function getPrices() {
	var prices = $('[data-selenium=display-price]');
	return _.map(prices, function(e) {
		return e.innerHTML;
	});
};



casper.start(url, function() {
this.echo(this.getTitle());
});

casper.waitForSelector('.hotel-name', function() {
	console.log('Hotel-name Selector is loaded');
});

casper.then(function() {
	this.clickLabel('Stars (5...1)', 'span');
	console.log('Click to filter');
});

casper.wait(8000, function() {
	this.echo("I've waited for 8 seconds.");
});

casper.then(function() {
	names = this.evaluate(getNames);
	//prices= this.evaluate(getPrices);
});

casper.then(function() {
	this.echo(names.length + ' names found:');
	this.echo('-'+names.join('\n -'));
	//this.echo('-'+prices.join('\n -')).exit();
})

casper.run()